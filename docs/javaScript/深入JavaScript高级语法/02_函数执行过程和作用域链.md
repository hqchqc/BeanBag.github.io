# 02\_函数执行过程和作用域链

## 函数的执行过程

首先看以下代码：

```javascript
var name = "why";

foo();

function foo(num) {
  var m = 10;
  console.log(m);
}

var num1 = 20;
var num2 = 30;
var result = num1 + num2;
```

具体执行过程如下：

1. 首先函数编译阶段会创造一个 GlobaleObject,这里面的有一些 Date、String 等对象，还有 window 对象，除此之外就是我们代码的这些变量：

```javascript
// Global Object (GO)
{
  ...,
  name: undefined,
  num1: undefined,
  num2: undefined,
  result: undefined,
  foo:
}
```

2. 当解析到函数类型的时候，这时候由于函数是一种特殊的对象类型，不是基本数据类型，所以引擎会单独开辟一块内存空间用以存放函数中的变量和父级作用域，于是上面的 GlobalObject 就会将 foo 的地方存放为一个地址；

```javascript
// Global Object (GO)
{
  ...,
  name: undefined,
  num1: undefined,
  num2: undefined,
  result: undefined,
  foo: 0xa00,
}
```

3. 编译阶段结束，到执行阶段，执行需要有一个 ECS(执行上下文栈)，有了它之后，那么现在要执行全局的代码，所以需要一个全局执行上下文 GEC ，它里边包含了两部分内容，一个是变量对象 VO，VO 这里等同于 GO，还有一个是为执行过程而开辟的空间；

4. 执行到函数的时候，函数的执行会开辟函数的 FEC(functional exection context 执行上下文), 它里边也是保存两部分内容，一个是活动对象 AO(Activation object),另一部分是执行过程开辟的空间，这个时候可以看到我们的 foo 中的 m 在编译阶段已经存在了，值为 undefined, 所以这里打印 undefined

5. 当函数执行完之后，整个 FEC 函数执行上下文会出栈，如果后面有重新调用的话，会重新入栈，出栈之后机会被内存回收

![函数执行过程](https://raw.githubusercontent.com/hqchqc/staticRepo/master/images/函数执行过程.png)

以上过程在 AST 阶段就会被确定下来，包括作用域

## 作用域链

当我们查找一个变量的时候，是根据作用域链来查找的
